var SYN=0;var ASYN=1;var TDDP_INSTRUCT=0;var TDDP_WRITE=1;var TDDP_READ=2;var TDDP_UPLOAD=3;var TDDP_DOWNLOAD=4;var TDDP_RESET=5;var TDDP_REBOOT=6;var TDDP_AUTH=7;var TDDP_GETPEERMAC=8;var TDDP_CONFIG=9;var TDDP_CHGPWD=10;var TDDP_LOGOUT=11;var PARSE_INIT=0;var PARSE_NOTE=1;var PARSE_CMD=2;var PARSE_ID=3;var PARSE_INDEX=4;var PARSE_VALUE=5;var PARSE_ERR=6;function TDDP(){this.dataBlocks=new DataBlock();this.findBlock=function(b){var c;for(var a in this.dataBlocks){if(typeof this.dataBlocks[a]=="object"&&this.dataBlocks[a].id==b){c=this.dataBlocks[a];break}}return c};this.elmInArray=function(d,b){var a;for(var c in d){if(d[c] instanceof Array){a=d[c][0];if(typeof a=="undefined"||typeof a!="object"){if(c==b){return true}continue}if(a.hasOwnProperty(b)){return true}}}return false};this.setElmValue=function(g,d,f,c){var b,a;f=decodeURI(f);for(var e in g){a=g[e];if(typeof a!="object"){if(e==d){g[e]=f;return}continue}if(Object.prototype.toString.call(a)!="[object Array]"){if(a.hasOwnProperty(d)){a[d]=f;return}continue}b=a[0];if(typeof b=="undefined"||typeof b!="object"){if(e==d){if(null==c){return}a[parseInt(c)]=f;return}continue}if(b.hasOwnProperty(d)){if(null==c){return}if(typeof a[parseInt(c)]!="object"){a[parseInt(c)]={}}a[parseInt(c)][d]=f;return}}};this.toText=function(h){var f="";var a=0;var b;var e="";for(var d in h){if(typeof h[d]!="object"){e=this.encodePara(h[d]);f+=d+" "+e+"\r\n";continue}b=h[d];if(typeof b=="object"&&Object.prototype.toString.call(b)!="[object Array]"){for(var g in b){e=this.encodePara(b[g]);f+=g+" "+e+"\r\n"}continue}b=h[d][0];if(typeof b=="undefined"||typeof b!="object"){b=h[d];for(a=0;a<b.length;a++){e=this.encodePara(b[a]);f+=d+" "+a+" "+e+"\r\n"}continue}b=h[d];for(a=0;a<b.length;a++){var c=b[a];for(var g in c){e=this.encodePara(c[g]);f+=g+" "+a+" "+e+"\r\n"}}}return f};this.elmToText=function(e,b,c,a){var d="";d="id "+0+"\r\n";if(e.hasOwnProperty("id")){d="id "+e.id+"\r\n"}if(undefined==a){d+=b+" "+c+"\r\n";return d}d+=b+" "+a+" "+c+"\r\n";return d};this.parser=function(g){var e=PARSE_INIT;var c={name:"",value:"",index:""};var h;var f="";var d="";var a=0;for(var b=0;b<g.length;b++){d=g.charAt(b);switch(e){case PARSE_INIT:c={name:"",value:"",index:""};a=0;if("#"==d){e=PARSE_NOTE;continue}if((" "<d)&&("~">=d)){e=PARSE_CMD;c.name+=d;a++}break;case PARSE_NOTE:case PARSE_ERR:if(("\r"==d)||("\n"==d)){e=PARSE_INIT}break;case PARSE_CMD:if((" "==d)||("\t"==d)){if(c.name=="id"){e=PARSE_ID;a=0;continue}if(undefined==h){e=PARSE_ERR;continue}a=0;e=PARSE_VALUE;if(this.elmInArray(h,c.name)){e=PARSE_INDEX}continue}if(("\r"==d)||("\n"==d)){e=PARSE_ERR;continue}c.name+=d;a++;break;case PARSE_ID:if((" "==d)||("\t"==d)){if(0!=a){e=PARSE_INIT;h=this.findBlock(f);f=""}continue}if(("\r"==d)||("\n"==d)){if(0==a){e=PARSE_ERR;continue}e=PARSE_INIT;h=this.findBlock(parseInt(f));f="";continue}if(("0">d)||(d>"9")){e=PARSE_ERR;continue}f+=d;a++;break;case PARSE_INDEX:if((" "==d)||("\t"==d)){if(0!=a){e=PARSE_VALUE;a=0}continue}if(("\r"==d)||("\n"==d)){e=PARSE_ERR;continue}if(("0">d)||(d>"9")){e=PARSE_ERR;continue}c.index+=d;a++;break;case PARSE_VALUE:if(((" "==d)||("\t"==d))&&(0==a)){continue}if(("\r"==d)||("\n"==d)){this.setElmValue(h,c.name,c.value,c.index);e=PARSE_INIT;continue}c.value+=d;a++;break}}if((PARSE_VALUE==e)&&(a>0)){this.setElmValue(h,c.name,c.value,c.index)}}};